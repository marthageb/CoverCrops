# CoverCrops
Description of code for CC estimation in Indiana Counties

Corresponding Author: Martha Farella, Indiana University, School of Public and Environmental Affairs, farellam@iu.edu

License: MIT

DOI:


---------------------------------------------
## Summary
Multiple pre-processing pipelines for analysis depending on data source: HLS, LST, and windshield survey.

After preprocessing, datasets combined for random forest and model evalaution.

---------------------------------------------


## Code Description
HLS DATA PREPROCESSING

		1. data acquired from: hls.gsfc.nasa.gov/data/v1.4/L30 (user guide: hls.gsfc.nasa.gov/wp-content/uploads/2019/01/HLS.v1.4.UserGuide_draft_ver3.1.pdf) for tiles: 16TDL, 16TDK, 16SDJ, 16SDH, 16TEL, 16TEK, 16SEJ, 16SEH, 16TFL, 16TFK, 16SFJ, 16SFH for dates: November 2014 - October 2020
		2. process_hdf4.R: HLS .hdf4 files converted to .tif files for downstream processing (single .tif per band x date) 
		3. HLS_cloudmsk.R: calculate cloud mask from QA layer, apply mask and make raster stack for entire year (Nov-Oct) for each band
		4. HLS_RFstacks.R: create stacks of the HLS data needed for the RF analysis. Subset by off-season dates (Nov-Mar); Calcualte VIs, and summary stats (min, max, median), write RFstack output
		5. extractbandvals.R: alternate option to 'HLS_RFstacks.R' Instead of doing VIs and summary statistic calculations on raster stacks, band reflectance values extracted for transect locations and THEN VIs and summary statistics calculated on extracted .csv values.
		
    
LST DATA PROCESSING

		1. LST data downloaded from EarthExplorer: Landsat/Landsat Collection 1/Landsat C1 U.S. Analysis Ready Data (ARD)/Landsat 4-8 U.S. ARD for path/rows: 021007, 021008, 021009, 021010, 022007, 022008, 022009, 022010, 023007, 023008, 023009, 023010 for dates: Oct 2014 - Mar 2020
		2. processLST.R: create LST and QA stack for off-season dates (Nov-Mar), mask LST stack by QA stack, apply scale factor, convert LST to degC, calculate median and sd, reproject to crs of HLS raster, write output


WINDSHIELD SURVEY PROCESSING

		1. format_windshield.R: format windshield survey data .shp files for downstream analysis. For each observation, extract the centroid coordinates of the polygons generated by REU students, date, filed #, site, tillage, residue, and covercrop values. Combine each site into a single dataset and save output. write a point .shp file for all observations
		2. shift_pts.R: move sample locations closer to road (30m from roads). Locations chosen by REU students did not fall in desired fields-- too far from road points. Calculate new coordinates, create .shp file for all survey location, and make 25m buffer .shp file around new points
	
  
RANDOM FOREST DATA ANALYSIS

		1. RFdata_prepro.R: Get the data formatted for RF analysis. Extract raster vals for the LST and HLS stacks for sample locs. Then, combine extracted vals with windshield survey data
		2. RF2class.R: Build the two-class (conventional tillage and CC) RF model. Apply 2-class model to No Till and other tillage observations (fig. 3) and calculate misclassification rastes for the different CC types (Table XXXX)
		3. RF3class.R: Build the three-class (CC, no till, and conventional till) RF model. 
		4. applyRF.R: Apply the 2- and 3-class RF models at the county-level. For each county, combine HLS stack with LSTsd and LSTmed (need to transform CRS and resample LST rasters). Mosaic HLS and LST tiles when more than one tile cover transect locations. Load the RF2class and RF3class models and then apply to RFstacks. Save 2- and 3-class predictions
		5. NLCDprocessing.R: pre-process the NLCD dataset for downstream analysis-- reproject to HLS crs and crop to extent covered by HLS tiles.
		6. CountyCounts.R: Get pixel counts of CC, Conv, and NoTill from the RFmodels at the county level for agriculture areas only. 
		7. CCdiff.R: Make .shp files with CC acreage differences from ISDA observed acreage in the 2- and 3-class models. 
		8. BoxPlots.R: Create boxplots of various spectral indices for the different cover crop types. perform ANOVA and calculate TukeyHSD values
		9. CC_NDVI.R: NDVI analysis for the cover crop season for the different cover crop types. Gap fill NDVI values as needed.
